#include <iostream>
#include "includes/psc_utils.hpp"
#include "includes/kohonen.hpp"
#include "includes/heatmap.hpp"
#include "includes/imagefeatures.hpp"
#include "includes/macro.hpp"
#include <string>
#include <opencv2/opencv.hpp>
#include <opencv2/imgproc/imgproc.hpp>
#include <opencv2/highgui/highgui.hpp>



float deltaAlpha = 0.1;
float deltaR = 0.1;
int N = 300;

std::string dirname = "/home/john/data_learn/";
std::string namefiles [] = {"sequence_0000001.png.yml","sequence_0000002.png.yml","sequence_0000003.png.yml","sequence_0000004.png.yml","sequence_0000005.png.yml","sequence_0000006.png.yml","sequence_0000007.png.yml","sequence_0000008.png.yml","sequence_0000009.png.yml","sequence_0000010.png.yml","sequence_0000011.png.yml","sequence_0000012.png.yml","sequence_0000013.png.yml","sequence_0000014.png.yml","sequence_0000015.png.yml","sequence_0000016.png.yml","sequence_0000017.png.yml","sequence_0000020.png.yml","sequence_0000021.png.yml","sequence_0000022.png.yml","sequence_0000023.png.yml","sequence_0000024.png.yml","sequence_0000025.png.yml","sequence_0000026.png.yml","sequence_0000027.png.yml","sequence_0000028.png.yml","sequence_0000029.png.yml","sequence_0000030.png.yml","sequence_0000031.png.yml","sequence_0000032.png.yml","sequence_0000033.png.yml","sequence_0000034.png.yml","sequence_0000035.png.yml","sequence_0000036.png.yml","sequence_0000037.png.yml","sequence_0000038.png.yml","sequence_0000039.png.yml","sequence_0000040.png.yml","sequence_0000041.png.yml","sequence_0000042.png.yml","sequence_0000043.png.yml","sequence_0000045.png.yml","sequence_0000046.png.yml","sequence_0000047.png.yml","sequence_0000048.png.yml","sequence_0000049.png.yml","sequence_0000050.png.yml","sequence_0000060.png.yml","sequence_0000061.png.yml","sequence_0000062.png.yml","sequence_0000063.png.yml","sequence_0000065.png.yml","sequence_0000066.png.yml","sequence_0000067.png.yml","sequence_0000068.png.yml","sequence_0000069.png.yml","sequence_0000070.png.yml","sequence_0000071.png.yml","sequence_0000072.png.yml","sequence_0000073.png.yml","sequence_0000075.png.yml","sequence_0000076.png.yml","sequence_0000077.png.yml","sequence_0000078.png.yml","sequence_0000079.png.yml","sequence_0000080.png.yml","sequence_0000090.png.yml","sequence_0000091.png.yml","sequence_0000092.png.yml","sequence_0000093.png.yml","sequence_0000095.png.yml","sequence_0000096.png.yml","sequence_0000097.png.yml","sequence_0000098.png.yml","sequence_0000099.png.yml","sequence_0000001.png.yml","sequence_0000002.png.yml","sequence_0000003.png.yml","sequence_0000004.png.yml","sequence_0000005.png.yml","sequence_0000006.png.yml","sequence_0000007.png.yml","sequence_0000008.png.yml","sequence_0000009.png.yml","sequence_0000110.png.yml","sequence_0000111.png.yml","sequence_0000112.png.yml","sequence_0000113.png.yml","sequence_0000114.png.yml","sequence_0000115.png.yml","sequence_0000116.png.yml","sequence_0000117.png.yml","sequence_0000120.png.yml","sequence_0000121.png.yml","sequence_0000122.png.yml","sequence_0000123.png.yml","sequence_0000124.png.yml","sequence_0000125.png.yml","sequence_0000126.png.yml","sequence_0000127.png.yml","sequence_0000128.png.yml","sequence_0000129.png.yml","sequence_0000130.png.yml","sequence_0000131.png.yml","sequence_0000132.png.yml","sequence_0000133.png.yml","sequence_0000134.png.yml","sequence_0000135.png.yml","sequence_0000136.png.yml","sequence_0000137.png.yml","sequence_0000138.png.yml","sequence_0000139.png.yml","sequence_0000140.png.yml","sequence_0000141.png.yml","sequence_0000142.png.yml","sequence_0000143.png.yml","sequence_0000145.png.yml","sequence_0000146.png.yml","sequence_0000147.png.yml","sequence_0000148.png.yml","sequence_0000149.png.yml","sequence_0000150.png.yml","sequence_0000160.png.yml","sequence_0000161.png.yml","sequence_0000162.png.yml","sequence_0000163.png.yml","sequence_0000165.png.yml","sequence_0000166.png.yml","sequence_0000167.png.yml","sequence_0000168.png.yml","sequence_0000169.png.yml","sequence_0000170.png.yml","sequence_0000171.png.yml","sequence_0000172.png.yml","sequence_0000173.png.yml","sequence_0000175.png.yml","sequence_0000176.png.yml","sequence_0000177.png.yml","sequence_0000178.png.yml","sequence_0000179.png.yml","sequence_0000180.png.yml","sequence_0000190.png.yml","sequence_0000191.png.yml","sequence_0000192.png.yml","sequence_0000193.png.yml","sequence_0000195.png.yml","sequence_0000196.png.yml","sequence_0000197.png.yml","sequence_0000198.png.yml","sequence_0000199.png.yml","sequence_0000201.png.yml","sequence_0000202.png.yml","sequence_0000203.png.yml","sequence_0000204.png.yml","sequence_0000205.png.yml","sequence_0000206.png.yml","sequence_0000207.png.yml","sequence_0000208.png.yml","sequence_0000209.png.yml","sequence_0000210.png.yml","sequence_0000211.png.yml","sequence_0000212.png.yml","sequence_0000213.png.yml","sequence_0000214.png.yml","sequence_0000215.png.yml","sequence_0000216.png.yml","sequence_0000217.png.yml","sequence_0000220.png.yml","sequence_0000221.png.yml","sequence_0000222.png.yml","sequence_0000223.png.yml","sequence_0000224.png.yml","sequence_0000225.png.yml","sequence_0000226.png.yml","sequence_0000227.png.yml","sequence_0000228.png.yml","sequence_0000229.png.yml","sequence_0000230.png.yml","sequence_0000231.png.yml","sequence_0000232.png.yml","sequence_0000233.png.yml","sequence_0000234.png.yml","sequence_0000235.png.yml","sequence_0000236.png.yml","sequence_0000237.png.yml","sequence_0000238.png.yml","sequence_0000239.png.yml","sequence_0000240.png.yml","sequence_0000241.png.yml","sequence_0000242.png.yml","sequence_0000243.png.yml","sequence_0000245.png.yml","sequence_0000246.png.yml","sequence_0000247.png.yml","sequence_0000248.png.yml","sequence_0000249.png.yml","sequence_0000250.png.yml","sequence_0000260.png.yml","sequence_0000261.png.yml","sequence_0000262.png.yml","sequence_0000263.png.yml","sequence_0000265.png.yml","sequence_0000266.png.yml","sequence_0000267.png.yml","sequence_0000268.png.yml","sequence_0000269.png.yml","sequence_0000270.png.yml","sequence_0000271.png.yml","sequence_0000272.png.yml","sequence_0000273.png.yml","sequence_0000275.png.yml","sequence_0000276.png.yml","sequence_0000277.png.yml","sequence_0000278.png.yml","sequence_0000279.png.yml","sequence_0000280.png.yml","sequence_0000290.png.yml","sequence_0000291.png.yml","sequence_0000292.png.yml","sequence_0000293.png.yml","sequence_0000295.png.yml","sequence_0000296.png.yml","sequence_0000297.png.yml","sequence_0000298.png.yml","sequence_0000299.png.yml","sequence_0000301.png.yml","sequence_0000302.png.yml","sequence_0000303.png.yml","sequence_0000304.png.yml","sequence_0000305.png.yml","sequence_0000306.png.yml","sequence_0000307.png.yml","sequence_0000308.png.yml","sequence_0000309.png.yml","sequence_0000310.png.yml","sequence_0000311.png.yml","sequence_0000312.png.yml","sequence_0000313.png.yml","sequence_0000314.png.yml","sequence_0000315.png.yml","sequence_0000316.png.yml","sequence_0000317.png.yml","sequence_0000320.png.yml","sequence_0000321.png.yml","sequence_0000322.png.yml","sequence_0000323.png.yml","sequence_0000324.png.yml","sequence_0000325.png.yml","sequence_0000326.png.yml","sequence_0000327.png.yml","sequence_0000328.png.yml","sequence_0000329.png.yml","sequence_0000330.png.yml","sequence_0000331.png.yml","sequence_0000332.png.yml","sequence_0000333.png.yml","sequence_0000334.png.yml","sequence_0000335.png.yml","sequence_0000336.png.yml","sequence_0000337.png.yml","sequence_0000338.png.yml","sequence_0000339.png.yml","sequence_0000340.png.yml","sequence_0000341.png.yml","sequence_0000342.png.yml","sequence_0000343.png.yml","sequence_0000345.png.yml","sequence_0000346.png.yml","sequence_0000347.png.yml","sequence_0000348.png.yml","sequence_0000349.png.yml","sequence_0000350.png.yml","sequence_0000360.png.yml","sequence_0000361.png.yml","sequence_0000362.png.yml","sequence_0000363.png.yml","sequence_0000365.png.yml","sequence_0000366.png.yml","sequence_0000367.png.yml","sequence_0000368.png.yml","sequence_0000369.png.yml","sequence_0000370.png.yml","sequence_0000371.png.yml","sequence_0000372.png.yml","sequence_0000373.png.yml","sequence_0000375.png.yml","sequence_0000376.png.yml","sequence_0000377.png.yml","sequence_0000378.png.yml","sequence_0000379.png.yml","sequence_0000380.png.yml","sequence_0000390.png.yml","sequence_0000391.png.yml","sequence_0000392.png.yml","sequence_0000393.png.yml","sequence_0000395.png.yml","sequence_0000396.png.yml","sequence_0000397.png.yml","sequence_0000398.png.yml","sequence_0000399.png.yml","sequence_0000401.png.yml","sequence_0000402.png.yml","sequence_0000403.png.yml","sequence_0000404.png.yml","sequence_0000405.png.yml","sequence_0000406.png.yml","sequence_0000407.png.yml","sequence_0000408.png.yml","sequence_0000409.png.yml","sequence_0000410.png.yml","sequence_0000411.png.yml","sequence_0000412.png.yml","sequence_0000413.png.yml","sequence_0000414.png.yml","sequence_0000415.png.yml","sequence_0000416.png.yml","sequence_0000417.png.yml","sequence_0000420.png.yml","sequence_0000421.png.yml","sequence_0000422.png.yml","sequence_0000423.png.yml","sequence_0000424.png.yml","sequence_0000425.png.yml","sequence_0000426.png.yml","sequence_0000427.png.yml","sequence_0000428.png.yml","sequence_0000429.png.yml","sequence_0000430.png.yml","sequence_0000431.png.yml","sequence_0000432.png.yml","sequence_0000433.png.yml","sequence_0000434.png.yml","sequence_0000435.png.yml","sequence_0000436.png.yml","sequence_0000437.png.yml","sequence_0000438.png.yml","sequence_0000439.png.yml","sequence_0000440.png.yml","sequence_0000441.png.yml","sequence_0000442.png.yml","sequence_0000443.png.yml","sequence_0000445.png.yml","sequence_0000446.png.yml","sequence_0000447.png.yml","sequence_0000448.png.yml","sequence_0000449.png.yml","sequence_0000450.png.yml","sequence_0000460.png.yml","sequence_0000461.png.yml","sequence_0000462.png.yml","sequence_0000463.png.yml","sequence_0000465.png.yml","sequence_0000466.png.yml","sequence_0000467.png.yml","sequence_0000468.png.yml","sequence_0000469.png.yml","sequence_0000470.png.yml","sequence_0000471.png.yml","sequence_0000472.png.yml","sequence_0000473.png.yml","sequence_0000475.png.yml","sequence_0000476.png.yml","sequence_0000477.png.yml","sequence_0000478.png.yml","sequence_0000479.png.yml","sequence_0000480.png.yml","sequence_0000490.png.yml","sequence_0000491.png.yml","sequence_0000492.png.yml","sequence_0000493.png.yml","sequence_0000495.png.yml","sequence_0000496.png.yml","sequence_0000497.png.yml","sequence_0000498.png.yml","sequence_0000499.png.yml","sequence_0000501.png.yml","sequence_0000502.png.yml","sequence_0000503.png.yml","sequence_0000504.png.yml","sequence_0000505.png.yml","sequence_0000506.png.yml","sequence_0000507.png.yml","sequence_0000508.png.yml","sequence_0000509.png.yml","sequence_0000510.png.yml","sequence_0000511.png.yml","sequence_0000512.png.yml","sequence_0000513.png.yml","sequence_0000514.png.yml","sequence_0000515.png.yml","sequence_0000516.png.yml","sequence_0000517.png.yml","sequence_0000520.png.yml","sequence_0000521.png.yml","sequence_0000522.png.yml","sequence_0000523.png.yml","sequence_0000524.png.yml","sequence_0000525.png.yml","sequence_0000526.png.yml","sequence_0000527.png.yml","sequence_0000528.png.yml","sequence_0000529.png.yml","sequence_0000530.png.yml","sequence_0000531.png.yml","sequence_0000532.png.yml","sequence_0000533.png.yml","sequence_0000534.png.yml","sequence_0000535.png.yml","sequence_0000536.png.yml","sequence_0000537.png.yml","sequence_0000538.png.yml","sequence_0000539.png.yml","sequence_0000540.png.yml","sequence_0000541.png.yml","sequence_0000542.png.yml","sequence_0000543.png.yml","sequence_0000545.png.yml","sequence_0000546.png.yml","sequence_0000547.png.yml","sequence_0000548.png.yml","sequence_0000549.png.yml","sequence_0000550.png.yml","sequence_0000560.png.yml","sequence_0000561.png.yml","sequence_0000562.png.yml","sequence_0000563.png.yml","sequence_0000565.png.yml","sequence_0000566.png.yml","sequence_0000567.png.yml","sequence_0000568.png.yml","sequence_0000569.png.yml","sequence_0000570.png.yml","sequence_0000571.png.yml","sequence_0000572.png.yml","sequence_0000573.png.yml","sequence_0000575.png.yml","sequence_0000576.png.yml","sequence_0000577.png.yml","sequence_0000578.png.yml","sequence_0000579.png.yml","sequence_0000580.png.yml","sequence_0000590.png.yml","sequence_0000591.png.yml","sequence_0000592.png.yml","sequence_0000593.png.yml","sequence_0000595.png.yml","sequence_0000596.png.yml","sequence_0000597.png.yml","sequence_0000598.png.yml","sequence_0000599.png.yml","sequence_0000601.png.yml","sequence_0000602.png.yml","sequence_0000603.png.yml","sequence_0000604.png.yml","sequence_0000605.png.yml","sequence_0000606.png.yml","sequence_0000607.png.yml","sequence_0000608.png.yml","sequence_0000609.png.yml","sequence_0000610.png.yml","sequence_0000611.png.yml","sequence_0000612.png.yml","sequence_0000613.png.yml","sequence_0000614.png.yml","sequence_0000615.png.yml","sequence_0000616.png.yml","sequence_0000617.png.yml","sequence_0000620.png.yml","sequence_0000621.png.yml","sequence_0000622.png.yml","sequence_0000623.png.yml","sequence_0000624.png.yml","sequence_0000625.png.yml","sequence_0000626.png.yml","sequence_0000627.png.yml","sequence_0000628.png.yml","sequence_0000629.png.yml","sequence_0000630.png.yml","sequence_0000631.png.yml","sequence_0000632.png.yml","sequence_0000633.png.yml","sequence_0000634.png.yml","sequence_0000635.png.yml","sequence_0000636.png.yml","sequence_0000637.png.yml","sequence_0000638.png.yml","sequence_0000639.png.yml","sequence_0000640.png.yml","sequence_0000641.png.yml","sequence_0000642.png.yml","sequence_0000643.png.yml","sequence_0000645.png.yml","sequence_0000646.png.yml","sequence_0000647.png.yml","sequence_0000648.png.yml","sequence_0000649.png.yml","sequence_0000650.png.yml","sequence_0000660.png.yml","sequence_0000661.png.yml","sequence_0000662.png.yml","sequence_0000663.png.yml","sequence_0000665.png.yml","sequence_0000666.png.yml","sequence_0000667.png.yml","sequence_0000668.png.yml","sequence_0000669.png.yml","sequence_0000670.png.yml","sequence_0000671.png.yml","sequence_0000672.png.yml","sequence_0000673.png.yml","sequence_0000675.png.yml","sequence_0000676.png.yml","sequence_0000677.png.yml","sequence_0000678.png.yml","sequence_0000679.png.yml","sequence_0000680.png.yml","sequence_0000690.png.yml","sequence_0000691.png.yml","sequence_0000692.png.yml","sequence_0000693.png.yml","sequence_0000695.png.yml","sequence_0000696.png.yml","sequence_0000697.png.yml","sequence_0000698.png.yml","sequence_0000699.png.yml","sequence_0000701.png.yml","sequence_0000702.png.yml","sequence_0000703.png.yml","sequence_0000704.png.yml","sequence_0000705.png.yml","sequence_0000706.png.yml","sequence_0000707.png.yml","sequence_0000708.png.yml","sequence_0000709.png.yml","sequence_0000710.png.yml","sequence_0000711.png.yml","sequence_0000712.png.yml","sequence_0000713.png.yml","sequence_0000714.png.yml","sequence_0000715.png.yml","sequence_0000716.png.yml","sequence_0000717.png.yml","sequence_0000720.png.yml","sequence_0000721.png.yml","sequence_0000722.png.yml","sequence_0000723.png.yml","sequence_0000724.png.yml","sequence_0000725.png.yml","sequence_0000726.png.yml","sequence_0000727.png.yml","sequence_0000728.png.yml","sequence_0000729.png.yml","sequence_0000730.png.yml","sequence_0000731.png.yml","sequence_0000732.png.yml","sequence_0000733.png.yml","sequence_0000734.png.yml","sequence_0000735.png.yml","sequence_0000736.png.yml","sequence_0000737.png.yml","sequence_0000738.png.yml","sequence_0000739.png.yml","sequence_0000740.png.yml","sequence_0000741.png.yml","sequence_0000742.png.yml","sequence_0000743.png.yml","sequence_0000745.png.yml","sequence_0000746.png.yml","sequence_0000747.png.yml","sequence_0000748.png.yml","sequence_0000749.png.yml","sequence_0000750.png.yml","sequence_0000760.png.yml","sequence_0000761.png.yml","sequence_0000762.png.yml","sequence_0000763.png.yml","sequence_0000765.png.yml","sequence_0000766.png.yml","sequence_0000767.png.yml","sequence_0000768.png.yml","sequence_0000769.png.yml","sequence_0000770.png.yml","sequence_0000771.png.yml","sequence_0000772.png.yml","sequence_0000773.png.yml","sequence_0000775.png.yml","sequence_0000776.png.yml","sequence_0000777.png.yml","sequence_0000778.png.yml","sequence_0000779.png.yml","sequence_0000780.png.yml","sequence_0000790.png.yml","sequence_0000791.png.yml","sequence_0000792.png.yml","sequence_0000793.png.yml","sequence_0000795.png.yml","sequence_0000796.png.yml","sequence_0000797.png.yml","sequence_0000798.png.yml","sequence_0000799.png.yml"};
cv::Mat get_image(const std::string& namefile)
{
  cv::FileStorage fs(namefile, cv::FileStorage::READ);
  cv::Mat features;
  fs["deep_features"] >> features;
  return features;
}


int main(int argc, char* argvc[])
{
	psc_utils::Kohonen map(2, ALPHA_INIT, R_INIT, 0);
	for(int p = 57; p < N ; p++)
	{
    	std::string namefile = dirname + namefiles[p];
    	cv::Mat mat = get_image(namefile);
    	psc_utils::ImageFeatures image(mat, p);
		for (int i = 0; i < FEATURES_SIZE_X; i++)
		{
			for (int j = 0; j < FEATURES_SIZE_Y; j++)
			{
				psc_utils::Vecteur v = image.getVector(i, j);
				map.evolution(v, deltaAlpha, deltaR);
			}
		}
    	if((p % 6) == 0)
    	{
    		map.save("kohonen_map");
        float q = ((float)p / (float)N) * 100.0;
        std::cout << q << " % environ" << std::endl;
    	}

    }


	return 0;
}
